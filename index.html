<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>PO CTF Flag Fetcher</title>
  <style>
    body { font-family: system-ui; margin: 2rem; }
    button { margin: 0.5rem; }
    pre { background:#eee; padding:1rem; }
  </style>
</head>
<body>
  <h1>PointerOverflow CTF</h1>
  <button id="loginBtn">Login</button>
  <button id="tokenBtn" disabled>Get Token</button>
  <button id="flagBtn" disabled>Get Flag</button>
  <pre id="output"></pre>

<script>
const loginBtn = document.getElementById('loginBtn');
const tokenBtn = document.getElementById('tokenBtn');
const flagBtn = document.getElementById('flagBtn');
const output = document.getElementById('output');

let apiToken = null;

const log = msg => output.textContent += msg + '\n';

loginBtn.onclick = async () => {
  log('Logging in...');
  const res = await fetch('https://web200-1.pointeroverflowctf.com/login', {
    method: 'POST',
    credentials: 'include'
  });
  const data = await res.json();
  log(`Login: ${res.status} ${JSON.stringify(data)}`);
  if(data.ok) {
    log('Session cookie set. You can now fetch token.');
    tokenBtn.disabled = false;
  }
};

tokenBtn.onclick = async () => {
  log('Fetching token...');
  const res = await fetch('https://web200-1.pointeroverflowctf.com/api/token', {
    credentials: 'include'
  });
  const data = await res.json();
  apiToken = data.apiToken;
  log(`Token: ${apiToken}`);
  flagBtn.disabled = false;
};

flagBtn.onclick = async () => {
  if(!apiToken) { log('No token!'); return; }
  log('Fetching flag...');
  const res = await fetch('https://web200-1.pointeroverflowctf.com/api/flag', {
    method: 'GET',
    headers: { 'X-Flag-Token': apiToken },
    credentials: 'include'
  });
  if(res.ok) {
    const text = await res.text();
    log('Flag: ' + text);
  } else {
    log(`Flag fetch failed: ${res.status}`);
  }
};
</script>
</body>
</html>
