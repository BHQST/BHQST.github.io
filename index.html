<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>PointerOverflow CTF - Fetch Flag</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<style>
  body { font-family: system-ui, sans-serif; margin: 2rem; }
  h1 { color: #2a7ae2; }
  button { font-size: 1rem; padding: 0.5rem 1rem; margin-top: 1rem; }
  pre { background: #f5f5f5; padding: 1rem; }
</style>
</head>
<body>
<h1>PointerOverflow CTF Flag Fetcher</h1>

<button id="loginBtn">Login</button>
<button id="getTokenBtn" disabled>Get Token</button>
<a id="flagLink" href="#" target="_blank" style="display:none;">Go to Flag</a>

<pre id="output"></pre>

<script>
const loginBtn = document.getElementById('loginBtn');
const getTokenBtn = document.getElementById('getTokenBtn');
const flagLink = document.getElementById('flagLink');
const output = document.getElementById('output');

const log = msg => {
  console.log(msg);
  output.textContent += msg + "\n";
};

// Step 1: Login
loginBtn.onclick = async () => {
  loginBtn.disabled = true;
  log("Logging in...");
  const res = await fetch("https://web200-1.pointeroverflowctf.com/login", {
    method: "POST",
    credentials: "include"
  });
  const data = await res.json();
  if(data.ok){
    log("Login successful. Session cookie set.");
    getTokenBtn.disabled = false;
  } else {
    log("Login failed!");
    loginBtn.disabled = false;
  }
};

// Step 2: Get token
getTokenBtn.onclick = async () => {
  getTokenBtn.disabled = true;
  log("Fetching token...");
  const res = await fetch("https://web200-1.pointeroverflowctf.com/api/token", {
    credentials: "include"
  });
  const data = await res.json();
  log("Token: " + data.apiToken);

  // Step 3: Set up link to flag
  flagLink.href = "https://web200-1.pointeroverflowctf.com/api/flag";
  flagLink.style.display = "inline-block";
  flagLink.onclick = e => {
    e.preventDefault();
    log("Fetching flag...");
    fetch(flagLink.href, {
      credentials: "include",
      headers: {
        "X-Flag-Token": data.apiToken
      }
    })
    .then(r => r.text())
    .then(flagText => log("Flag: " + flagText));
  };
};
</script>
</body>
</html>
